# 设计

### 异步通讯


#### 同步

```

   serviceA              serviceB

------->
         |
         |
         |
            ------------->
                           |
                           |
                           |
            <-------------
         |
         |
         |
<-------

```


#### 异步调用

* 异步返回后，轮询
* 异步返回后，回调


#### 消息订阅

* 发送方不关心订阅方的处理结果
* 通过broker解耦
  - 服务解耦
  - 吞吐量解耦
  - 故障隔离
  - 业务流程不再明显
  - 事务处理变复杂
  - broker成了一个中心，需要高可用不丢消息


### 幂等

* 需要全局的ID，
  - UUID的劣势
  - `snowflake`
* 查询之后在处理
* 存储报错的方式处理
* 要求数据库共享


### 事务补偿
