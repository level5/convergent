# 仓库



项目在仓库中的位置根据坐标是这样的```groupId/artifactId/version/artifactId-version.packaging```

## 基础

#### 本地仓库

仓库分为远程仓库和本地仓库，maven使用构件的时候，会现在本地仓库中查找，如果存在，直接使用；如果不存在，则会查看远程仓库是否有该构件，如果有，则下载到本地仓库再使用。如果远程和本地仓库都没有，则报错。

本地仓库在```~/.m2/repository```，也可以在```setting.xml```文件中改变位置：
```xml
<setting>
    <localRepository>/new/dir</localRepository>
</setting>
```
本地仓库在maven输入第一条命令之后才会建立。

#### 远程仓库

远程仓库包含分为三类
- 中央仓库，maven核心自带的仓库，这是maven默认的仓库，安装文件中自带了他的配置；
- 内部仓库，自己局域网内架设的仓库，可以代理所有外部仓库，也可以将自己的项目部署到这个上面；
- 第三方仓库.

##### 远程仓库的配置

在```pom.xml```中配置

```xml
code...
```

- ```id```: 必须唯一，```central```为中央仓库的ID，是用他的话会替换掉中央仓库。
- ```releases```和```snapshots```：表示对不同版本的控制
  * ```enabled```: 为true的话表示从该仓库下载该版本的构建。
  * ```updatePolicy```: 表示从maven仓库检查更新的频率，可选值为```daily```, ```never```, ```always```, ```interval:n```(n为整数分钟).
  * ```checksumPolicy```: 是否检查校验和，可选值为```warn```(默认值),```fail```, ```ignore```.

```bash
mvn clean install -U # 强制检查更新
```

认证则必须配置在```settings.xml```中。

```xml
code...
```

##### 部署到远程仓库

在```pom.xml```中配置。
```xml
code...
```

正确配置后```mvn clean deploy```会将构建部署到远程仓库。

#### 镜像

任何对远程仓库的访问，都将转换访问对应的镜像仓库。

编辑```settings.xml```。

```xml
code...
```

可以使用内部仓库作为所有远程仓库的镜像。这样所有对远程仓库的访问都会转换到内部仓库。

## 进阶

### 版本

#### 快照版本

为了解决共同开发每天都需要更新的问题。当使用快照机制，比如将版本设定为```2.1-SNAPSHOTS```发布到远程仓库是，maven会自动为构建加上时间戳。比如```2.1-20151111.122321-12```.这样maven就能随时找到最新版。

#### 构建依赖解析机制

1. 当依赖范围是```system```的时候，直接从本地路径解析构建
2. 尝试从本地仓库找到构建。
3. 如果本地不存在，当依赖显式版本的时候,如```2.1```, ```2.1-beta-1```。遍历远程仓库下载
4. 如果版本是```RELEASE```或者```LATEST```,读取所有远程仓库的```groupId/artifactId/maven-metadata.xml```，与本地对应元数据合并，计算出对应的真实值。然后下载。
5. 如果为```SNAPSHOT```,合并元数据，找出最新的快照版本。然后下载。然后复制该时间戳的版本到到非时间戳的版本。

上面提到的```LATEST```包含了快照版本。
